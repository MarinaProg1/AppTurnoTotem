import { useState , useEffect } from "react";
import { crearTurno } from "../api/TurnoApi";
import logoBanco from "../assets/LogoBanco.svg";
import "./Totem.css";
import Button from "../component/Button";

export default function Totem() {
  const [turno, setTurno] = useState(null);

  const crear = async (tipo) => {
    const res = await crearTurno({ tipo });
    setTurno(res);
  };

  return (
    <div className="totem-root">
      {turno ? (
        <Ticket turno={turno} onReset={() => setTurno(null)} />
      ) : (
        <Inicio onSelect={crear} />
      )}
    </div>
  );
}

function Inicio({ onSelect }) {
  return (
    <div className="totem">
      <div className="logoTitulo">
        <img src={logoBanco} alt="Logo Banco" />
        <h1>Demo turnos</h1>
      </div>
       <h2>Sacar turno</h2>
      
      <Button text="CAJA" onClick={() => onSelect("Caja")} />
      <Button text="ATENCIÓN" onClick={() => onSelect("Atención")} />
      <Button text="PRESTAMOS" onClick={() => onSelect("Prestamos")} />
        <svg width="130" height="162" viewBox="0 0 130 162" fill="none" xmlns="http://www.w3.org/2000/svg">
<g id="manoclick">
<path id="Vector" d="M88.803 67.0414C87.555 63.8783 84.1434 62.6113 80.2153 64.222C79.0438 64.7026 77.9313 65.3962 76.9193 66.2414L76.9082 65.8462C76.84 63.4327 75.8567 61.5407 74.14 60.5184C72.4231 59.4961 70.1781 59.4658 67.8184 60.4335C66.6638 60.9072 65.5492 61.5917 64.5224 62.4477L64.0427 45.4703C63.9745 43.0568 62.9914 41.1645 61.2745 40.1421C59.5578 39.1199 57.3126 39.0898 54.9529 40.0576C50.0821 42.0551 46.2334 47.734 46.3739 52.7162L48.1324 114.953C48.3748 123.531 52.224 129.868 58.7504 132.541L59.7037 150.794C59.7477 152.353 59.17 152.982 62.2897 154.077C63.8138 153.451 64.624 152.253 64.8186 150.247L64.2315 128.888C64.206 127.985 63.7603 127.311 63.0326 127.072C57.2765 125.181 53.8578 119.939 53.6531 112.689L51.8946 50.4521C51.869 49.5463 52.1896 48.5539 52.7976 47.6569C53.4055 46.7599 54.2278 46.0658 55.1132 45.7029C56.9412 44.9531 58.4711 45.8642 58.5236 47.7337L59.6 85.8345C59.6441 87.3933 60.9155 88.1504 62.4398 87.5255C63.9638 86.9 65.1634 85.13 65.12 83.5707L64.7602 70.8379C64.7599 70.8346 64.76 70.8311 64.7599 70.8283C64.7067 68.9591 66.151 66.828 67.9785 66.0792C68.8641 65.716 69.7062 65.7272 70.3505 66.1109C70.9946 66.4944 71.3635 67.2043 71.3889 68.1099L71.6351 76.8191C71.6355 76.8398 71.6359 76.8604 71.6365 76.8808C71.6368 76.8923 71.6373 76.904 71.6378 76.9153L71.8105 83.0351C71.8546 84.594 73.126 85.351 74.6503 84.7261C76.1743 84.1007 77.3739 82.3306 77.3305 80.7714L77.1555 74.5796C77.1397 73.684 77.4597 72.7065 78.0595 71.8215C78.6674 70.9245 79.4898 70.2305 80.3752 69.8676C81.2605 69.5047 82.103 69.5153 82.7473 69.899C83.3914 70.2826 83.7601 70.9927 83.7855 71.8983L83.9378 77.2878C83.9381 77.2997 83.9384 77.3117 83.9386 77.3236C83.9388 77.3304 83.939 77.3367 83.9391 77.3435L84.0209 80.2356C84.0649 81.7945 85.3363 82.5515 86.8606 81.9266C88.3845 81.3014 89.5843 79.5315 89.5408 77.9719L89.4577 75.0377C89.4382 74.138 89.7584 73.154 90.3614 72.2642C90.9696 71.3669 91.7921 70.673 92.6775 70.3101C93.5629 69.9472 94.4051 69.9581 95.0492 70.3417C95.6933 70.7253 96.0622 71.4351 96.0876 72.3408L96.7285 95.0234C96.9331 102.273 93.8849 110.167 88.3673 116.682C87.6689 117.507 87.272 118.526 87.2973 119.428L87.7733 136.274C87.8174 137.833 89.0888 138.59 90.6131 137.965C91.3751 137.652 92.0562 137.054 92.5411 136.338C93.0261 135.623 93.3149 134.79 93.293 134.011L92.8561 118.554C99.084 110.649 102.491 101.338 102.248 92.7596L101.608 70.077C101.539 67.6635 100.556 65.7715 98.8393 64.7492C97.1226 63.727 94.8777 63.6967 92.518 64.6644C91.2041 65.2034 89.9429 66.0152 88.803 67.0414Z" fill="#47744cff"/>
<path id="Vector_2" d="M72.8536 47.3462C73.678 47.2419 74.5085 46.8418 75.1846 46.2788C75.8607 45.7158 76.3825 44.9899 76.5902 44.2348C79.4605 33.787 72.5157 26.4586 61.1089 27.8986C55.5832 28.5962 49.8465 31.2232 44.956 35.2953C40.0655 39.3673 36.6065 44.3973 35.2159 49.4585C34.8011 50.9686 36.7843 52.5393 38.4332 52.3313C40.082 52.1227 40.7715 50.215 41.1871 48.7046C42.1761 45.1042 44.6367 41.5263 48.1157 38.6295C51.5947 35.7326 55.6756 33.864 59.6063 33.3678C67.721 32.3433 72.6614 37.5565 70.6192 44.9889C70.2046 46.4988 71.2049 47.5543 72.8536 47.3462Z" fill="#47744cff"/>
<path id="Vector_3" d="M68.5291 12.7945C49.3388 13.8015 28.6578 28.4874 22.4278 45.5331C18.6692 55.8181 20.9033 65.0989 28.4044 70.3592C29.479 71.1128 31.4661 70.6951 32.8425 69.422C34.2193 68.1505 34.4641 66.5091 33.3894 65.7556C27.1832 61.4029 25.3344 53.725 28.4433 45.2173C33.5958 31.1179 50.7029 18.97 66.5768 18.137C74.2666 17.7335 80.5243 20.0137 84.197 24.5579C87.8698 29.102 88.5177 35.366 86.0219 42.196C84.2894 46.9376 81.1269 51.6432 76.8768 55.8038C75.5468 57.1058 75.3864 58.7281 76.5182 59.4274C77.4861 60.0254 79.0857 59.7547 80.3607 58.8493C80.5767 58.6958 80.7832 58.5246 80.9758 58.336C86.1181 53.3021 89.943 47.612 92.0375 41.8807C95.0548 33.624 94.2714 26.0509 89.8313 20.5573C85.3908 15.0637 77.8255 12.3067 68.5291 12.7945Z" fill="#47744cff"/>
</g>
</svg>

    </div>
  );
}

function Ticket({ turno, onReset }) {
 useEffect(() => {
    const tiempo = 10 * 1000; 
    const timer = setTimeout(() => {
      onReset();
    }, tiempo);

    // limpiar el timer si el componente se desmonta
    return () => clearTimeout(timer);
  }, [onReset]);

  return (
    <div className="tiket-containar">
      <div className="ticket">
        <h2>Demo ticket Banco</h2>

        <div className="ticket-numero">{turno.turno}</div>

        <p>{turno.tipo}</p>
        <p>{new Date(turno.fecha).toLocaleString()}</p>

        <p className="ticket-footer">Aguarde su llamado</p>
      </div>

      <button className="volver" onClick={onReset}>
        Volver
      </button>
    </div>
  );
}
